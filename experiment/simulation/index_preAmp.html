<!-- This HTML page and script files are developed by
    Piyali Chattopadhyay
    Project Scientist-Technical,
    Virtual Labs IIT Kharagpur.-->

<!DOCTYPE html>
<html lang="en"><!--html tag start-->
<head>
    <title>Study and operation of the DC Speed and Position control setup</title>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="../css/adik.css" rel="stylesheet">
  
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js"></script>
  <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  
  <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  <script  src="./js/preamp.js">   </script>
  
  
	
 <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.2.1/math.js"></script>
  <script src=" https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.2.1/math.min.js  "></script>
 
 
<script src="https://cdnjs.cloudflare.com/ajax/libs/jQuery-Knob/1.2.13/jquery.knob.min.js"></script>
<!-- <script src="https://canvasjs.com/assets/script/canvasjs.min.js"> </script> -->

<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

<link rel="stylesheet" href="./css/preamp.css">
<link rel="stylesheet" href="./css/demo.css">



  <style>
	.dial {
	
position:absolute;
    border: 2px solid #060808;
    border-radius:50%;
    background-color:#060808;
    background-image:linear-gradient(90deg,#060808,#3A3B3B);
	
	box-shadow: 5px 5px 8px #D9DBDB;
}

.dialhandle {
	
position:absolute;
cursor:pointer;
background-color: #11B8C9;
  animation: glow 1s ease-in-out infinite alternate;
}
@-webkit-keyframes glow {
  from {
    text-shadow:  0 0 20px #fff, 0 0 30px #0867DF;
  }
  
  to {
    text-shadow: 0 0 20px #fff, 0 0 30px #023474;
  }
}
	
  </style>
  
  
  
</head>
<body><!--body tag start-->
    <div class="container p-3 my-3 text-primary text-center border"><!--First Container under body tag start-->
        <div class="row"><!--First row under 1st container start-->
            <div class="col-md-3"><!--First col under 1st row start-->
                <img class="img-fluid rounded" src="./images/vlabs.png" alt="VLabs logo">
            </div><!--First col under 1st row end-->
            <div class="col-md-6"><!--2nd col under 1st row start-->
                <p class="display-1"> <b> Virtual Labs <br> IIT Kharagpur </b> </p>
            </div><!--2nd col under 1st row end-->
            <div class="col-md-3"><!--3rd col under 1st row start-->
                <img class="img-fluid rounded" src="./images/iitkgp.png" alt="IIT KGP Logo" >
            </div><!--3rd col under 1st row end-->
        </div><!--First row under 1st container end-->
    
        <hr>
        <div class="row"><!--2nd row under 1st container start-->
            <div class="col-md-3"><!--First col under 2nd row start-->

            </div><!--First col under 2nd row end-->
            <div class="col-md-6"><!--2nd col under 2nd row start-->
                <p class="h1"> <b>Simulation</b> </p>
            </div><!--2nd col under 2nd row end-->
            <div class="col-md-3"><!--3rd col under 2nd row start-->

            </div><!--3rd col under 2nd row end-->
        </div><!--2nd row under 1st container end-->
        <hr>
        
    </div><!--First Container under body tag end-->
    
	
    <div class="container p-3 my-5 text-left border"><!--3rd Container under body tag start-->
      <div class="row"><!--First row under 3rd container start-->
        <div class="col-md-1"></div><!--First col under 3rd container start& end-->
        <div class="col-md-10"><!--2nd col under 3rd container start-->
            <p class="text-center bg-success"> <a class="nav-link" data-bs-toggle="tab"  id="instcontrol" style="background-color:#128BD9"  ><span class=" h3 text-dark"> Instructions </span></a>
              <div id="inst" style="display:block;height:200px;overflow-y:auto;text-align:justify">
					<ol>
					<b>Pre Amplifier Characteristics</b><br/>
					
                      <li>First connect the circuit diagram properly through the connecting dots (black dots) according to the instructions below.<br/><br/>
					  
					  Attenuator Unit upper potentiometer point 1 - lower potentiometer point 4, Attenuator Unit upper potentiometer point 2 - lower potentiometer point 6,
					  Attenuator Unit upper potentiometer point 3 - Pre Amplifier Unit +15 V, Attenuator Unit upper potentiometer point 1 - Pre Amplifier Unit 0 V,
					  Attenuator Unit lower potentiometer point 5 - Pre Amplifier Unit point 1, Power Supply +15 V (left one) - Pre Amplifier Unit +15 V, Power Supply -15 V (left one) - Pre Amplifier Unit -15 V,
					  Power Supply 0 V (left one) - Pre Amplifier Unit 0 V					  
					  </li></br>
  
					  <li>Click on 'Check Connection' button to check whether the connection is proper or not. Then click on the 'Power' switch in Power Supply box ,the led will glow.</li><br/>
					 
					 <li>Rotate the lower potentiometer knob in Attenuator Unit. Observe the input voltage in the black box above.
					 Rotate the knob untill the voltage is about +1.5 V, the Pre Amplifier outputs V<sub>o</sub>(3) and V<sub>o</sub>(4) are shown in respective boxes.</li><br/>

					 <li>Click on 'Show Table' button to get the observation data. Rotate the lower potentiometer knob anti clockwise to decrease the input voltage upto 0 value
					 and click on 'Show Table' button each time after decreasing the voltage in 0.1 V step.</li><br/>
					 
					 <li>Now change the connection to apply -15 V as supply voltage. This can be achieved by deleting the connection Attenuator Unit upper potentiometer point 3 - Pre Amplifier Unit +15 V by clicking on the 
					 connected wire and connecting Attenuator Unit upper potentiometer point 3 - Pre Amplifier Unit -15 V.
					 Click on 'Check Connection' button to make sure that proper connection has been done.</li><br/>
					 
					 <li>Now Rotate the lower potentiometer knob in Attenuator Unit in clockwise direction. Observe the input voltage in the black box above.
					 Rotate the knob to increase the voltage in -0.1 V step untill -1.5 V, the Pre Amplifier outputs V<sub>o</sub>(3) and V<sub>o</sub>(4) are shown in respective boxes.
					 Click on 'Show Table' button each time after increasing the voltage.</li><br/>
					 
					 
					<li>After the total procedure (steps 3-6) is complete for +1.5 V to -1.5 V input voltage, click on 'Plot' button to observe the plot 
					'Pre Amplifier output voltages (V<sub>o</sub>(3) and V<sub>o</sub>(4)) (Volts) Vs. Input voltage (V<sub>i</sub>) (Volts)'.
					Hover on the plot section, click on the camera icon to download the plot.
					</li><br/> 
					 
					<li> Rotate the potentiometer knob to its minimum value, switch off the power. Click on 'Clear' button.</li><br/>

					<li> Click on 'Position Control' button to perform the experiment of controlling the position of the motor rotor. Click on 'Pre Amplifier Characteristics' button to
					observe the characteristics of the Pre Amplifier , to perform the experiment of controlling the speed of the motor click on 'Speed Control' button.</li><br/>
					
					 </ol>
					<br><br>
					
		   </div>
            </p> 
          </div><!--2nd col under 3rd container end-->
		  
        <div class="col-md-1"></div><!--3rd col under 3rd container start& end-->
      </div><!--First row under 3rd container end-->
    </div><!--3rd Container under body tag end-->
	
    <div class="container p-3 my-5 text-center border" id="canvas" ><!--Fourth container under body tag start-->
	
<div class="row ">
	
		<div class="col-md-6" >
		<div class="img-container">
		<img class="img-fluid " id="power" src="images/power_supply.png " />
		<img class="img-fluid " id="ammeter" src="images/amp_pointer.jpg " />
		<img class="img-fluid " id="powerled" src="images/groff.png " />
		<img class="img-fluid " id="togsw" src="images/off.png " onclick="power_on()" />
		<div id="bd7"></div>
		<div id="bd8"></div>
		<div id="bd9"></div>
		<div id="bd10"></div>
		<div id="bd11"></div>
		<div id="bd12"></div>
		<div id="bd13"></div> 
		<div id="bd14"></div>
		<div id="bd15"></div>
		</div>
		
		<input type="number" id="partchk" min="1" value="1" max="7" style="visibility:hidden;"><!--checks exp parts-->
		</div>		
		<div class="col-md-6" >
		
		<button type="button" id="tacho_olclSpeed"  class="btn btn-primary" onclick="part1_2_3()" >Speed Control</button>
		<button type="button" id="preAmp_Char"  class="btn btn-primary" onclick="part4_5()" >Pre Amplifier Characteristics</button>
		<button type="button" id="PositionC"  class="btn btn-primary " onclick="part6_7()" >Position Control</button>	
		<br/><br/>
		<button type="button" id="check"  class="btn btn-primary " >Check Connection</button>
		<button type="button" id="drawTable"  class="btn btn-info " onclick="createTable3()" >Show Table</button>
		<button type="button" id="drawPlot"  class="btn btn-success " onclick="plot()" >Plot</button>
		<button type="button" id="clear"  class="btn btn-danger " onclick="refresh()" >Clear</button>
			
		</div>
		
		</div>
		
		
		<div class="row my-5 gy-2">
		<div class="col-md-1"></div>
		<div class="col-md-5" >
		<div class="img-container">
		
		<input type="number" id="IV" min="-1.5" max="1.5" step="0.1" value="0" readOnly=readOnly><span style="color:blue;font-weight:bold;position:absolute;top:-12%;left:11%">Input voltage (V)</span>
		
		
		<img class="img-fluid " id="AU" src="images/AU.png " />
		<!---knob 1 1st col 1st row--------->
		<!-- <div class="bluedot" id="knob1" style=" width:21.5%;height:18.5%;top:13%;left:18.5%;pointer-events:none;">
		<div class="handlep" id="knob1p" onclick="rotate1()"style="width:30%;height:30%;top:33%;left:0%;"></div>
		<div class="handlen" id="knob1n"onclick="rotate2())" style="width:30%;height:30%;top:33%;left:70%;"></div>
		</div> -->
		<div id="knob1" class="dial"  style=" width:21.5%;height:18.5%;top:13%;left:18.5%;pointer-events:auto;">
		<div class="dialhandle" style="width:20%;height:5%;top:85%;left:20%;transform:rotate(304deg)"></div>				
		</div>
		<input type="number" id="Au_up" min="0" value="0" max="10" step="0.1" style="position: absolute;width: 18%;height: 6%;top: 30%;left: 22%;text-align: center;background: transparent;border: none;"readOnly=readOnly>
		
		<!---knob 2 1st col 1st row--------->
		<!-- <div class="bluedot" id="knob2" style=" width:22.4%;height:19%;top:51.5%;left:20.7%;pointer-events:none;">
		<div class="handlep" id="knob2p" onclick="rotate3();preAmp_Char()"style="width:30%;height:30%;top:33%;left:0%;"></div>
		<div class="handlen" id="knob2n"onclick="rotate4();preAmp_Char()" style="width:30%;height:30%;top:33%;left:70%;"></div>
		</div> -->
		<div id="knob2" class="dial"  style="width:22.4%;height:19%;top:51.5%;left:20.7%;pointer-events:auto;">
		<div class="dialhandle" style="width:20%;height:5%;top:85%;left:20%;transform:rotate(304deg)"></div>				
		</div>
		<input type="number" id="Au_down" min="0" value="0" max="10.5" step="0.7" style="position: absolute;width: 23%;height: 6%;top: 69%;left: 22%;text-align: center;background: transparent;border: none;"readOnly=readOnly>
		
		<!--Connection points in this circuit only-->
		<div id="bd1"></div> 
		<div id="bd2"></div>
		<div id="bd3"></div>
		<div id="bd4"></div>
		<div id="bd5"></div>
		<div id="bd6"></div> 		
		
		</div>	
		</div>
		
		<div class="col-md-5" >
		<div class="img-container" >
		<img class="img-fluid " id="preAmp" src="images/pre_amp.png "/>
		<img class="img-fluid " id="togsw2" src="images/off.png " onclick="preAmp_on()" />
		<input type="number" id="V03"  value="0" readOnly=readOnly><span style="color:blue;font-weight:bold;position:absolute;top:-12%;left:13%">V<sub>o</sub>(3) (V)</span>
		<input type="number" id="V04"  value="0" readOnly=readOnly><span style="color:blue;font-weight:bold;position:absolute;top:-12%;left:62%">V<sub>o</sub>(4) (V)</span>
		<div id="bd16"></div> 
		<div id="bd17"></div>
		<div id="bd18"></div>
		<div id="bd19"></div>
		<div id="bd20"></div>
		<div id="bd21"></div>
		<div id="bd22"></div>
		<div id="bd23"></div>
		</div>
		</div>
		
		<div class="col-md-1"></div>		
		</div>

	
			<div class="row my-5 gy-2"><!--- 4th row under fourth container start--->
	
		 
        <div class="col-md-8 "><!--1st col under 4th row start -->	
		
		
			<table id="myTable3" style="visibility:hidden;width:100%">
			
				
				  <tr>
					<th>Sl No.</th>
					<th>input voltage(V<sub>i</sub>)(Volts)</th> 
					<th colspan ="3">Pre Amplifier Output (Volts)</th>
				</tr>
				<tr>
					<th></th>
					<th></th> 
					<th >V<sub>o</sub>(3)</th>
					<th >V<sub>o</sub>(4)</th>
					<th >V<sub>o</sub>(4)-V<sub>o</sub>(3)</th>
				</tr>
				  
			</table>
			
			
		</div>
		<div class="col-md-4 "><!--1st col under 4th row start -->	
		
		<!--<span id="part3_result" style="display:none;color:blue;font-weight:bold">Pre Amplifier Constant = 10.66 </span>-->
			
		</div>
			
		</div>


	 <div class="row justify-content-center"><!-----------------------graph T vs. w----------------------------------------->
		
	 
			<div class="col-md-12">
				<!-- <div id = "plotbucket" class="content-center" style="display:none; position:relative; border:3px solid white;height:530px;width:823px ">
				<button type="button" id="exportChart" class="btn btn-primary"  style="display:none;position:absolute;left:9%;">Download Plot</button>
				<button type="button" id="result" class="btn btn-primary" onclick="refresh()"  style="display:none;position:absolute;left:27%">OK</button><br/><br/>
					<div id="chartContainer"  style="display:none; position:absolute; height: 80%; width: 100%;z-index:1 "></div>
				</div> -->
				<div align="center" id="myPlot" style="width:100%;max-width:800px;padding-left:10%"></div>
				
			</div>
			
			
		
	</div>	

	
	
          <!-- Code End here-->
        </div><!--Fourth container under body tag end-->
          
      <!--</div>
    </div>-->

    <div class="container p-3 my-5 text-primary text-center border"><!--Last and fifth container under body tag start-->
      <div class="row">
        <footer>
          <div class="row ce">
            <div class="col-sm-12">
              <p class="h5"><i> Copyright ©2022 <a href="http://vlabs.iitkgp.ac.in/vlt/">Virtual Labs IIT Kharagpur</a> </i><br><br>
              <a href="../../license/index.html" target="_blank"> Licensing Terms </a>
            </p>
            </div>
          </div>
        </footer>
      </div>
  </div><!--Last and fifth container under body tag end-->
  <script>

var knobPositionX;
      var knobPositionY;
      var mouseX;
      var mouseY;
      var knobCenterX;
      var knobCenterY;
      var adjacentSide;
      var oppositeSide;
      var currentRadiansAngle;
      var getRadiansInDegrees;
      var finalAngleInDegrees;
      var volumeSetting;
      //var tickHighlightPosition;
      //var audio = new Audio("https://www.cineblueone.com/maskWall/audio/skylar.mp3"); //Celine Dion's "Ashes"
      //var startingTickAngle = -135;
      //var tickContainer = document.getElementById("tickContainer");
      var knob1 = document.getElementById("knob1");
	  var knob2 = document.getElementById("knob2");
	  
      var boundingRectangle1 = knob1.getBoundingClientRect(); //get rectangular geometric data of knob (x, y, width, height)
	  var boundingRectangle2 = knob2.getBoundingClientRect();
	 
      function main1()
      {
          knob1.addEventListener(getMouseDown(), onMouseDown1); //listen for mouse button click
          document.addEventListener(getMouseUp(), onMouseUp1); //listen for mouse button release
	  }
	  function main2()
      {
          knob2.addEventListener(getMouseDown(), onMouseDown2); //listen for mouse button click
          document.addEventListener(getMouseUp(), onMouseUp2); //listen for mouse button release
	  }
	  
      //on mouse buttons down
      function onMouseDown1()
      {
	  document.addEventListener(getMouseMove(), onMouseMove1); //start drag
      }	  
	  function onMouseDown2()
      {
	  document.addEventListener(getMouseMove(), onMouseMove2); //start drag
      }
	  
      //on mouse buttons release
      function onMouseUp1()
      {
          document.removeEventListener(getMouseMove(), onMouseMove1); //stop drag
      }
	  function onMouseUp2()
      {
          document.removeEventListener(getMouseMove(), onMouseMove2); //stop drag
      }
	  
      //compute mouse angle relative to center of volume knob
      //For clarification, see my basic trig explanation at:
      //https://www.quora.com/What-is-the-significance-of-the-number-pi-to-the-universe/answer/Kevin-Lam-15
      function onMouseMove1(event)
      {	  
          knobPositionX = boundingRectangle1.left; //get knob's global x position
          knobPositionY = boundingRectangle1.top; //get knob's global y position

          if(detectMobile() == "desktop")
          {
              mouseX = event.pageX; //get mouse's x global position
              mouseY = event.pageY; //get mouse's y global position
          } else {
              mouseX = event.touches[0].pageX; //get finger's x global position
              mouseY = event.touches[0].pageY; //get finger's y global position
          }

          knobCenterX = boundingRectangle1.width / 2 + knobPositionX; //get global horizontal center position of knob relative to mouse position
          knobCenterY = boundingRectangle1.height / 2 + knobPositionY; //get global vertical center position of knob relative to mouse position

          adjacentSide = knobCenterX - mouseX; //compute adjacent value of imaginary right angle triangle
          oppositeSide = knobCenterY - mouseY; //compute opposite value of imaginary right angle triangle

          //arc-tangent function returns circular angle in radians
          //use atan2() instead of atan() because atan() returns only 180 degree max (PI radians) but atan2() returns four quadrant's 360 degree max (2PI radians)
          currentRadiansAngle = Math.atan2(adjacentSide, oppositeSide);

          getRadiansInDegrees = currentRadiansAngle * 180 / Math.PI; //convert radians into degrees

          finalAngleInDegrees = -(getRadiansInDegrees - 135); //knob is already starting at -135 degrees due to visual design so 135 degrees needs to be subtracted to compensate for the angle offset, negative value represents clockwise direction

          //only allow rotate if greater than zero degrees or lesser than 270 degrees
          if(finalAngleInDegrees >= 0 && finalAngleInDegrees <= 300)
          {
              knob1.style.transform = "rotate(" + finalAngleInDegrees + "deg)"; //use dynamic CSS transform to rotate volume knob

              //270 degrees maximum freedom of rotation / 100% volume = 1% of volume difference per 2.7 degrees of rotation
              volumeSetting = Math.round(finalAngleInDegrees / (300 / 100));
              var voltValue = volumeSetting * (10/100); 
              document.getElementById("Au_up").value = math.round(voltValue) ;//+ "%"; //update volume text
          }
      }

///knob2/////
function onMouseMove2(event)
      {
          knobPositionX = boundingRectangle2.left; //get knob's global x position
          knobPositionY = boundingRectangle2.top; //get knob's global y position

          if(detectMobile() == "desktop")
          {
              mouseX = event.pageX; //get mouse's x global position
              mouseY = event.pageY; //get mouse's y global position
          } else {
              mouseX = event.touches[0].pageX; //get finger's x global position
              mouseY = event.touches[0].pageY; //get finger's y global position
          }

          knobCenterX = boundingRectangle2.width / 2 + knobPositionX; //get global horizontal center position of knob relative to mouse position
          knobCenterY = boundingRectangle2.height / 2 + knobPositionY; //get global vertical center position of knob relative to mouse position

          adjacentSide = knobCenterX - mouseX; //compute adjacent value of imaginary right angle triangle
          oppositeSide = knobCenterY - mouseY; //compute opposite value of imaginary right angle triangle

          //arc-tangent function returns circular angle in radians
          //use atan2() instead of atan() because atan() returns only 180 degree max (PI radians) but atan2() returns four quadrant's 360 degree max (2PI radians)
          currentRadiansAngle = Math.atan2(adjacentSide, oppositeSide);

          getRadiansInDegrees = currentRadiansAngle * 180 / Math.PI; //convert radians into degrees

          finalAngleInDegrees = -(getRadiansInDegrees - 135); //knob is already starting at -135 degrees due to visual design so 135 degrees needs to be subtracted to compensate for the angle offset, negative value represents clockwise direction

          //only allow rotate if greater than zero degrees or lesser than 270 degrees
          if(finalAngleInDegrees >= 0 && finalAngleInDegrees <= 300)
          {
              knob2.style.transform = "rotate(" + finalAngleInDegrees + "deg)"; //use dynamic CSS transform to rotate volume knob

              //270 degrees maximum freedom of rotation / 100% volume = 1% of volume difference per 2.7 degrees of rotation
              volumeSetting = Math.floor(finalAngleInDegrees / (300 / 100));
				var voltValue = volumeSetting * (10/100); 
				var pmv = volumeSetting * (1.6/100); 
              document.getElementById("Au_down").value = math.round(voltValue);
			  
			  if(document.getElementById('partchk').value == 4){
					document.getElementById('IV').value = math.floor(pmv*10)/10;
					preAmp_Char();
					}
					
					if(document.getElementById('partchk').value == 5){
					document.getElementById('IV').value = -math.floor(pmv*10)/10;
					preAmp_Char();
					}
              
             // document.getElementById("volumeValue").innerHTML = volumeSetting + "%"; //update volume text
          }
      }
	  
	  
      //detect for mobile devices from https://www.sitepoint.com/navigator-useragent-mobiles-including-ipad/
      function detectMobile()
      {
          var result = (navigator.userAgent.match(/(iphone)|(ipod)|(ipad)|(android)|(blackberry)|(windows phone)|(symbian)/i));

          if(result !== null)
          {
              return "mobile";
          } else {
              return "desktop";
          }
      }

      function getMouseDown()
      {
          if(detectMobile() == "desktop")
          {
              return "mousedown";
          } else {
              return "touchstart";
          }
      }

      function getMouseUp()
      {
          if(detectMobile() == "desktop")
          {
              return "mouseup";
          } else {
              return "touchend";
          }
      }

      function getMouseMove()
      {
          if(detectMobile() == "desktop")
          {
              return "mousemove";
          } else {
              return "touchmove";
          }
      }

      main1();
	  main2();
	  
</script>
  <script src="./js/jsPlumb.js"></script>	
	<script src="./js/demo_preamp.js"> </script> 
	 
</body><!--body tag end-->
</html><!--html tag end-->
